
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>dziewicza.gpx</title>
    <style>
        body { font-family: sans-serif; }
        canvas { }
        #itineraryTable th {
            position: sticky;
            top: 0;
            background-color: #f2f2f2; /* Add a background to prevent content from showing through */
            z-index: 1; /* Ensure it stays on top of scrolling content */
        }
        .current-position-row {
            font-weight: bold;
            color: red;
        }
        #itineraryTable th:nth-child(4),
        #itineraryTable td:nth-child(4),
        #itineraryTable th:nth-child(5),
        #itineraryTable td:nth-child(5) {
            display: none;
        }
        #itineraryTable {
            font-size: 2em;
        }
    </style>
</head>
<body>
    <canvas id="profileCanvas" style="width: 100%; height: 33vh;"></canvas>
    <script>
        window.addEventListener('load', function() {
            const canvas = document.getElementById('profileCanvas');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            const elevations = [106.0, 106.0, 105.0, 105.0, 106.0, 107.0, 108.0, 109.0, 111.0, 115.0, 118.0, 120.0, 126.0, 128.0, 129.0, 131.0, 134.0, 135.0, 135.0, 136.0, 138.0, 138.0, 141.0, 144.0, 145.0, 142.0, 141.0, 142.0, 143.0, 142.0, 139.0, 133.0, 132.0, 129.0, 128.0, 127.0, 126.0, 125.0, 124.0, 122.0, 114.0, 115.0, 115.0, 114.0, 116.0, 108.0, 107.0, 105.0, 105.0, 105.0, 106.0, 101.0, 98.0, 97.0, 96.0, 96.0, 96.0, 95.0, 95.0, 95.0, 95.0, 95.0, 96.0, 96.0, 97.0, 104.0, 109.0, 113.0, 114.0, 114.0, 114.0, 114.0, 115.0, 116.0, 117.0, 122.0, 125.0, 128.0, 132.0, 133.0, 134.0, 136.0, 138.0, 141.0, 144.0, 145.0, 142.0, 141.0, 141.0, 141.0, 139.0, 138.0, 138.0, 137.0, 136.0, 133.0, 128.0, 128.0, 128.0, 125.0, 120.0, 119.0, 118.0, 116.0, 114.0, 111.0, 105.0, 106.0, 107.0, 109.0, 109.0, 109.0, 109.0, 108.0, 107.0, 107.0, 109.0, 111.0, 114.0, 117.0, 119.0, 122.0, 120.0, 123.0, 123.0, 124.0, 128.0, 131.0, 133.0, 139.0, 142.0, 143.0, 142.0, 141.0, 142.0, 145.0, 143.0, 141.0, 140.0, 140.0, 141.0, 141.0, 139.0, 137.0, 137.0, 136.0, 136.0, 136.0, 135.0, 132.0, 130.0, 130.0, 130.0, 128.0, 127.0, 123.0, 119.0, 116.0, 114.0, 112.0, 111.0, 109.0, 108.0, 106.0, 106.0, 106.0, 106.0, 106.0, 106.0];
            const distances = [0, 0.01524899740880781, 0.03170716915911127, 0.0503462687911553, 0.09048813827051286, 0.11703695967209383, 0.15191370390237147, 0.17221887404932085, 0.19069585397936642, 0.22236784977341992, 0.23921944183426685, 0.25311565911845185, 0.2836628235089734, 0.29791153616573257, 0.31260020758082313, 0.3293946909081874, 0.342765419099487, 0.35179801554848067, 0.35179801554848067, 0.35719281219568383, 0.37280258967687585, 0.3969036932248975, 0.42371796579662624, 0.47132921118055254, 0.48930286643197096, 0.5148244326046647, 0.5253072684296949, 0.5497125255559616, 0.5761324223359425, 0.5959917780948752, 0.6161579805740419, 0.6527524294584692, 0.6697813906533933, 0.6989448546262255, 0.708505119724544, 0.7201532268636819, 0.7349004902377371, 0.7585060970374673, 0.7802763669663196, 0.8673394198589024, 0.9153796993901062, 0.9216641678611269, 0.9216641678611269, 0.9279486363321476, 0.978629460047542, 1.0514599012737411, 1.1011168534074556, 1.1446607305721515, 1.1844754107076991, 1.2032439745652248, 1.2221623565932629, 1.3105468047028805, 1.361282410036976, 1.407658545928215, 1.4460419577852412, 1.4931533714148129, 1.5375840851072802, 1.5674097981880157, 1.571728549725976, 1.571728549725976, 1.6427419978700917, 1.6676750435660426, 1.6990781908036516, 1.7529055089014376, 1.7751030708983164, 1.8552997528314519, 1.900078158794604, 1.932620075563486, 1.9533134176411675, 1.9628592114165988, 1.9628592114165988, 1.9684280785224322, 1.9917341561478428, 2.008065491473067, 2.0305334001479842, 2.072975700875221, 2.0989295458969344, 2.121535594327351, 2.146326502126357, 2.155507979538249, 2.1659743345977964, 2.1817733063917446, 2.199439560808848, 2.226253833380577, 2.273865078764503, 2.2918387340159216, 2.3173603001886156, 2.327843136013646, 2.340319438059138, 2.355613797658905, 2.380184923048769, 2.3938875744613037, 2.402137390440951, 2.4178251469510963, 2.4310043414424967, 2.467233068414545, 2.49240244272705, 2.49240244272705, 2.4948648428852174, 2.517443267451687, 2.5550360718903993, 2.5684508587940935, 2.5800992396870512, 2.5956781724435873, 2.6141099543096438, 2.6529823841411484, 2.6962914514684315, 2.7325523137276924, 2.756614264168251, 2.7997264354963467, 2.800949579689509, 2.800949579689509, 2.830089025491874, 2.871350207054672, 2.892072449452335, 2.9157918939031506, 2.9438243394783763, 2.9638665238518924, 2.987279588282848, 3.0129990905460935, 3.0350208558994436, 3.0530856079228323, 3.1031669857295823, 3.120352182762422, 3.120352182762422, 3.123984180524189, 3.147566718393469, 3.1675063094984393, 3.190388371708788, 3.2269828205932156, 3.2471490230723825, 3.2670083788313153, 3.2934282756112965, 3.317833532737563, 3.3283163685625934, 3.3538379347352874, 3.370696205813292, 3.3895727872854686, 3.398981350188929, 3.4090481293640047, 3.4207540471896745, 3.435837604110491, 3.452587333132876, 3.466597893890271, 3.466597893890271, 3.4702673264689676, 3.476714496136469, 3.482163047541728, 3.490939955889637, 3.5079408277360504, 3.518841024853323, 3.5310305647289337, 3.5381298299674353, 3.5501423374021503, 3.5619607867206984, 3.584697313328108, 3.6072790391168517, 3.6352826336968156, 3.650883358780685, 3.676442417376707, 3.692509767162924, 3.7168513822028744, 3.737448545257767, 3.7547550278292627, 3.8069734472097596, 3.8217720665190527, 3.8217720665190527, 3.9522475724078983, 3.9536141481114684];
            const lats = [52.481508, 52.481388, 52.481273, 52.481218, 52.481027, 52.480901, 52.480737, 52.480639, 52.480518, 52.480343, 52.480277, 52.480217, 52.480059, 52.480014, 52.480026, 52.479993, 52.479917, 52.479878, 52.479878, 52.479856, 52.479807, 52.479659, 52.479845, 52.480075, 52.48014, 52.480239, 52.480272, 52.480343, 52.480436, 52.480491, 52.480556, 52.480688, 52.480545, 52.480321, 52.480272, 52.480272, 52.480315, 52.480359, 52.480299, 52.479528, 52.479101, 52.479117, 52.479117, 52.479101, 52.478663, 52.478029, 52.477591, 52.477208, 52.476852, 52.476857, 52.476798, 52.476278, 52.475993, 52.47584, 52.475752, 52.475709, 52.475643, 52.475632, 52.475638, 52.475638, 52.475709, 52.475703, 52.475747, 52.475862, 52.476059, 52.476748, 52.477137, 52.477421, 52.477607, 52.47769, 52.47769, 52.477739, 52.477946, 52.478089, 52.478291, 52.47863, 52.478844, 52.479025, 52.479205, 52.479281, 52.479375, 52.479517, 52.479659, 52.479845, 52.480075, 52.48014, 52.480239, 52.480272, 52.480195, 52.48014, 52.480108, 52.480064, 52.480014, 52.479884, 52.479785, 52.479544, 52.479517, 52.479517, 52.479511, 52.479429, 52.479276, 52.479238, 52.479238, 52.47915, 52.479101, 52.478997, 52.478904, 52.479205, 52.479413, 52.479796, 52.479807, 52.479807, 52.480069, 52.480436, 52.480622, 52.480835, 52.480852, 52.480808, 52.48071, 52.480573, 52.480491, 52.480436, 52.480873, 52.480885, 52.480885, 52.48089, 52.480847, 52.480764, 52.480688, 52.480556, 52.480491, 52.480436, 52.480343, 52.480272, 52.480239, 52.48014, 52.480288, 52.480452, 52.480535, 52.480617, 52.48071, 52.480814, 52.480961, 52.481087, 52.481087, 52.48112, 52.481164, 52.481213, 52.481289, 52.481437, 52.481498, 52.481498, 52.481519, 52.481618, 52.481722, 52.481891, 52.482088, 52.482312, 52.482422, 52.482433, 52.482389, 52.4824, 52.482406, 52.482428, 52.482887, 52.482832, 52.482832, 52.482367, 52.482378];
            const lons = [17.005359, 17.005468, 17.005621, 17.005881, 17.006384, 17.006717, 17.007156, 17.007409, 17.007596, 17.007965, 17.008189, 17.008369, 17.008738, 17.008935, 17.009151, 17.009393, 17.009546, 17.009663, 17.009663, 17.009734, 17.00995, 17.01021, 17.010462, 17.011055, 17.011298, 17.011638, 17.011783, 17.012124, 17.012483, 17.012762, 17.01304, 17.013535, 17.013625, 17.013849, 17.013965, 17.014137, 17.014343, 17.014684, 17.01499, 17.015214, 17.015322, 17.015233, 17.015233, 17.015322, 17.015529, 17.015799, 17.015942, 17.016076, 17.016139, 17.015862, 17.0156, 17.014613, 17.014028, 17.013391, 17.012843, 17.012151, 17.011504, 17.011064, 17.011001, 17.011001, 17.009959, 17.009591, 17.009133, 17.008361, 17.008414, 17.008764, 17.008935, 17.009051, 17.009061, 17.009097, 17.009097, 17.009114, 17.009168, 17.009223, 17.009231, 17.009519, 17.009672, 17.009824, 17.01004, 17.010093, 17.010085, 17.010093, 17.01021, 17.010462, 17.011055, 17.011298, 17.011638, 17.011783, 17.011917, 17.012124, 17.012483, 17.012672, 17.012762, 17.012852, 17.012959, 17.013319, 17.013688, 17.013688, 17.013723, 17.014028, 17.014523, 17.014711, 17.014883, 17.015062, 17.015322, 17.01587, 17.016491, 17.016697, 17.016795, 17.016894, 17.016894, 17.016894, 17.016885, 17.016795, 17.016814, 17.016795, 17.016382, 17.016095, 17.015789, 17.015483, 17.015187, 17.014936, 17.014757, 17.014504, 17.014504, 17.014451, 17.01411, 17.013849, 17.013535, 17.01304, 17.012762, 17.012483, 17.012124, 17.011783, 17.011638, 17.011298, 17.011244, 17.011172, 17.011145, 17.011082, 17.011001, 17.010858, 17.010804, 17.010804, 17.010804, 17.010804, 17.010866, 17.010866, 17.010831, 17.010768, 17.010642, 17.010462, 17.010363, 17.010292, 17.010256, 17.010067, 17.009986, 17.009797, 17.009654, 17.009277, 17.009051, 17.008692, 17.008388, 17.008135, 17.008298, 17.008099, 17.008099, 17.00633, 17.006321];
            const importantPointsData = [{"name": "toilets", "lat": 52.4816371, "lon": 17.005672, "trail_distance": 0, "trail_elevation": 106.0}, {"name": "recycling", "lat": 52.4812834, "lon": 17.0053564, "trail_distance": 0.01524899740880781, "trail_elevation": 106.0}, {"name": "shelter", "lat": 52.48125607692308, "lon": 17.00522301153846, "trail_distance": 0.01524899740880781, "trail_elevation": 106.0}, {"name": "map", "lat": 52.4812591, "lon": 17.0056387, "trail_distance": 0.03170716915911127, "trail_elevation": 105.0}, {"name": "peak Dziewicza G\u00f3ra", "lat": 52.479996, "lon": 17.0111017, "trail_distance": 0.47132921118055254, "trail_elevation": 144.0}, {"name": "shelter", "lat": 52.4800919, "lon": 17.0109379, "trail_distance": 0.47132921118055254, "trail_elevation": 144.0}, {"name": "board G\u00f3ra Anny", "lat": 52.4801481, "lon": 17.011057, "trail_distance": 0.47132921118055254, "trail_elevation": 144.0}, {"name": "guidepost", "lat": 52.4801496, "lon": 17.0110113, "trail_distance": 0.47132921118055254, "trail_elevation": 144.0}, {"name": "nature Szczyt Dziewiczej G\u00f3ry", "lat": 52.4801623, "lon": 17.0111737, "trail_distance": 0.48930286643197096, "trail_elevation": 145.0}, {"name": "tower Wie\u017ca widokowa na Dziewiczej G\u00f3rze", "lat": 52.48003285, "lon": 17.01133309, "trail_distance": 0.48930286643197096, "trail_elevation": 145.0}, {"name": "wayside_cross", "lat": 52.480534, "lon": 17.0150263, "trail_distance": 3.0350208558994436, "trail_elevation": 119.0}, {"name": "map", "lat": 52.4819636, "lon": 17.0061648, "trail_distance": 3.9522475724078983, "trail_elevation": 106.0}, {"name": "peak", "lat": 52.4844672, "lon": 17.0033025, "trail_distance": 3.9536141481114684, "trail_elevation": 106.0}];
            const minLat = 52.475632;
            const maxLat = 52.482887;
            const minLon = 17.005359;
            const maxLon = 17.016894;
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const paddingTop = 60;
            const paddingRight = 0;
            const paddingBottom = 40;
            const paddingLeft = 80;

            const maxEle = Math.max(...elevations);
            const minEle = Math.min(...elevations);
            const eleRange = maxEle - minEle;
            const maxDist = distances[distances.length - 1];

            function getX(distance) {
                return paddingLeft + (distance / maxDist) * (width - paddingLeft - paddingRight);
            }

            function getY(elevation) {
                return height - paddingBottom - ((elevation - minEle) / eleRange) * (height - paddingTop - paddingBottom);
            }

            // Draw profile
            ctx.beginPath();
            ctx.moveTo(getX(distances[0]), getY(elevations[0]));
            for (let i = 1; i < elevations.length; i++) {
                ctx.lineTo(getX(distances[i]), getY(elevations[i]));
            }
            ctx.stroke();

            // Draw axes
            ctx.beginPath();
            ctx.moveTo(paddingLeft, paddingTop);
            ctx.lineTo(paddingLeft, height - paddingBottom);
            ctx.lineTo(width - paddingRight, height - paddingBottom);
            ctx.stroke();

            // Draw labels
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial'; // Set a much bigger font
            ctx.textAlign = 'left';
            ctx.fillText(maxEle.toFixed(0) + ' m', 5, paddingTop + 5);
            ctx.fillText(minEle.toFixed(0) + ' m', 5, height - paddingBottom);

            // Draw y-axis label
            ctx.save();
            ctx.translate(60, height / 2); // Translate to the position where the text will be drawn
            ctx.rotate(-Math.PI / 2); // Rotate -90 degrees (counter-clockwise)
            ctx.textAlign = 'center'; // Center the text horizontally after rotation
            ctx.fillText('Elevation', 0, 0); // Draw text at the new origin
            ctx.restore(); // Restore the canvas to its original state

            ctx.textAlign = 'center';
            ctx.fillText('Distance', width / 2, height - paddingBottom + 30);
            ctx.textAlign = 'left';
            ctx.fillText('0 km', paddingLeft, height - paddingBottom + 30);
            ctx.textAlign = 'right';
            ctx.textAlign = 'right';
            ctx.fillText(maxDist.toFixed(1) + ' km', width - paddingRight, height - paddingBottom + 30);

            function haversine(lat1, lon1, lat2, lon2) {
                const R = 6371; // Radius of Earth in kilometers
                const dLat = (lat2 - lat1) * Math.PI / 180;  // deg2rad below
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = 
                    0.5 - Math.cos(dLat)/2 + 
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                    (1 - Math.cos(dLon))/2;

                return R * 2 * Math.asin(Math.sqrt(a));
            }

            function calculateBearing(startLat, startLng, destLat, destLng) {
              // Convert degrees to radians
              const toRadians = (degrees) => degrees * Math.PI / 180;
              const toDegrees = (radians) => radians * 180 / Math.PI;

              const startLatRad = toRadians(startLat);
              const startLngRad = toRadians(startLng);
              const destLatRad = toRadians(destLat);
              const destLngRad = toRadians(destLng);

              // Calculate the difference in longitude
              const deltaLng = destLngRad - startLngRad;

              // Calculate the bearing
              const y = Math.sin(deltaLng) * Math.cos(destLatRad);
              const x = Math.cos(startLatRad) * Math.sin(destLatRad) -
                        Math.sin(startLatRad) * Math.cos(destLatRad) * Math.cos(deltaLng);
              let bearing = Math.atan2(y, x);

              // Convert the bearing from radians to degrees
              bearing = toDegrees(bearing);

              // Ensure the bearing is a positive number between 0 and 360
              return (bearing + 360) % 360;
            }

            function getBearingArrow(bearing) {
                if (bearing >= 337.5 || bearing < 22.5) {
                    return '↑'; // North
                } else if (bearing >= 22.5 && bearing < 67.5) {
                    return '↗'; // North-East
                } else if (bearing >= 67.5 && bearing < 112.5) {
                    return '→'; // East
                } else if (bearing >= 112.5 && bearing < 157.5) {
                    return '↘'; // South-East
                } else if (bearing >= 157.5 && bearing < 202.5) {
                    return '↓'; // South
                } else if (bearing >= 202.5 && bearing < 247.5) {
                    return '↙'; // South-West
                } else if (bearing >= 247.5 && bearing < 292.5) {
                    return '←'; // West
                } else if (bearing >= 292.5 && bearing < 337.5) {
                    return '↖'; // North-West
                }
                return ''; // Should not happen
            }

            // Find nearest point
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userLat = position.coords.latitude;
                    const userLon = position.coords.longitude;

                    console.log('User Location:', userLat, userLon);

                    let nearestIndex = 0;
                    let minDistance = Infinity;
                    for (let i = 0; i < lats.length; i++) {
                        const dist = haversine(userLat, userLon, lats[i], lons[i]);
                        if (dist < minDistance) {
                            minDistance = dist;
                            nearestIndex = i;
                        }
                    }
                    console.log('Nearest Index:', nearestIndex, 'Min Distance:', minDistance);
                    updateMapAndTable(nearestIndex, userLat, userLon);
                }, error => {
                    console.error('Error getting user location:', error);
                    // Fallback to a random location if geolocation fails
                    const randomLat = minLat + Math.random() * (maxLat - minLat);
                    const randomLon = minLon + Math.random() * (maxLon - minLon);
                    let nearestIndex = 0;
                    let minDistance = Infinity;
                    for (let i = 0; i < lats.length; i++) {
                        const dist = haversine(randomLat, randomLon, lats[i], lons[i]);
                        if (dist < minDistance) {
                            minDistance = dist;
                            nearestIndex = i;
                        }
                    }
                    updateMapAndTable(nearestIndex, randomLat, randomLon);
                });
            } else {
                console.error('Geolocation is not supported by this browser.');
                // Fallback to a random location if geolocation is not supported
                const randomLat = minLat + Math.random() * (maxLat - minLat);
                const randomLon = minLon + Math.random() * (maxLon - minLon);
                let nearestIndex = 0;
                let minDistance = Infinity;
                for (let i = 0; i < lats.length; i++) {
                    const dist = haversine(randomLat, randomLon, lats[i], lons[i]);
                    if (dist < minDistance) {
                        minDistance = dist;
                        nearestIndex = i;
                    }
                }
                updateMapAndTable(nearestIndex, randomLat, randomLon);
            }

            function updateMapAndTable(nearestIndex, actualLat, actualLon) {
                console.log('Nearest Index:', nearestIndex);

                // Draw current position line
                const currentX = getX(distances[nearestIndex]);
                ctx.beginPath();
                ctx.strokeStyle = 'red';
                ctx.moveTo(currentX, paddingTop);
                ctx.lineTo(currentX, height - paddingBottom);
                ctx.stroke();

                // Draw info on top of the line
                const currentDist = distances[nearestIndex];
                const percentage = (currentDist / maxDist) * 100;
                const ele = elevations[nearestIndex];
                ctx.fillStyle = 'red';
                ctx.font = '20px Arial'; // Set a much bigger font for current position info

                let textX = currentX;
                if (currentX < paddingLeft + 50) {
                    ctx.textAlign = 'left';
                    textX = paddingLeft;
                } else if (currentX > width - paddingRight - 50) {
                    ctx.textAlign = 'right';
                    textX = width - paddingRight;
                } else {
                    ctx.textAlign = 'center';
                }

                ctx.fillText(ele.toFixed(0) + ' m', textX, paddingTop - 30);
                ctx.fillText(currentDist.toFixed(1) + ' km (' + percentage.toFixed(0) + '%)', textX, paddingTop - 5);

                const tableBody = document.querySelector('#itineraryTable tbody');

                document.getElementById('currentDistance').innerText = currentDist.toFixed(1);
                document.getElementById('currentHeight').innerText = ele.toFixed(0);

                const maxEleIndex = elevations.indexOf(maxEle);
                const maxEleDistance = distances[maxEleIndex];

                document.getElementById('startDistance').innerText = distances[0].toFixed(1);
                document.getElementById('startHeight').innerText = elevations[0].toFixed(0);

                document.getElementById('highestPointDistance').innerText = maxEleDistance.toFixed(1);
                document.getElementById('highestPointHeight').innerText = maxEle.toFixed(0);

                document.getElementById('finishDistance').innerText = maxDist.toFixed(1);
                document.getElementById('finishHeight').innerText = elevations[elevations.length - 1].toFixed(0);

                document.getElementById('startLat').innerText = lats[0].toFixed(5);
                document.getElementById('startLon').innerText = lons[0].toFixed(5);

                document.getElementById('currentLat').innerText = lats[nearestIndex].toFixed(5);
                document.getElementById('currentLon').innerText = lons[nearestIndex].toFixed(5);

                document.getElementById('highestPointLat').innerText = lats[maxEleIndex].toFixed(5);
                document.getElementById('highestPointLon').innerText = lons[maxEleIndex].toFixed(5);

                document.getElementById('finishLat').innerText = lats[lats.length - 1].toFixed(5);
                document.getElementById('finishLon').innerText = lons[lons.length - 1].toFixed(5);

                const currentLat = actualLat;
                const currentLon = actualLon;

                const startBearing = calculateBearing(currentLat, currentLon, lats[0], lons[0]);
                const highestPointBearing = calculateBearing(currentLat, currentLon, lats[maxEleIndex], lons[maxEleIndex]);
                const finishBearing = calculateBearing(currentLat, currentLon, lats[lats.length - 1], lons[lons.length - 1]);

                document.getElementById('startDistFromCurrent').innerText = haversine(currentLat, currentLon, lats[0], lons[0]).toFixed(1) + ' km ' + getBearingArrow(startBearing);
                document.getElementById('currentDistFromCurrent').innerText = '';
                document.getElementById('highestPointDistFromCurrent').innerText = haversine(currentLat, currentLon, lats[maxEleIndex], lons[maxEleIndex]).toFixed(1) + ' km ' + getBearingArrow(highestPointBearing);
                document.getElementById('finishDistFromCurrent').innerText = haversine(currentLat, currentLon, lats[lats.length - 1], lons[lons.length - 1]).toFixed(1) + ' km ' + getBearingArrow(finishBearing);

                importantPointsData.forEach((point, index) => {
                    const dist = haversine(currentLat, currentLon, point.lat, point.lon);
                    const bearing = calculateBearing(currentLat, currentLon, point.lat, point.lon);
                    document.getElementById(`importantPointDistFromCurrent_${index}`).innerText = dist.toFixed(1) + ' km ' + getBearingArrow(bearing);
                });

                const rows = Array.from(tableBody.children);

                rows.sort((a, b) => {
                    const distanceA = parseFloat(a.cells[0].textContent.trim());
                    const distanceB = parseFloat(b.cells[0].textContent.trim());

                    if (isNaN(distanceA) && isNaN(distanceB)) return 0; // Both NaN, keep original order
                    if (isNaN(distanceA)) return 1; // A is NaN, B is a number, put A at the end
                    if (isNaN(distanceB)) return -1; // B is NaN, A is a number, put B at the end

                    return distanceA - distanceB;
                });

                while (tableBody.firstChild) {
                    tableBody.removeChild(tableBody.firstChild);
                }
                rows.forEach(row => tableBody.appendChild(row));

                // Scroll to current position
                const tableContainer = document.getElementById('tableContainer');
                const currentPositionRow = document.getElementById('currentDistance').closest('tr'); // Find the parent <tr>

                if (tableContainer && currentPositionRow) {
                    currentPositionRow.scrollIntoView({ block: "center" });
                    currentPositionRow.classList.add('current-position-row');
                }
            }

            // Calculate remaining height for tableContainer
            const canvasHeight = document.getElementById('profileCanvas').offsetHeight;

            const totalOccupiedHeight = canvasHeight;
            const windowHeight = window.innerHeight;
            const remainingHeight = windowHeight - totalOccupiedHeight - 25;

            if (tableContainer) {
                tableContainer.style.height = `${remainingHeight}px`;
            }
    });
    </script>
    <div id="tableContainer" style="height: 200px; overflow-y: scroll;">
        <table border="1" width="100%" id="itineraryTable">
            <thead>
                <tr>
                    <th>Distance (km)</th>
                    <th>Height (m)</th>
                    <th>Point</th>
                    <th>Lat</th>
                    <th>Lon</th>
                    <th>From Current (km)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="startDistance"></td>
                    <td id="startHeight"></td>
                    <td>Start</td>
                    <td id="startLat"></td>
                    <td id="startLon"></td>
                    <td id="startDistFromCurrent"></td>
                </tr>
                <tr>
                    <td id="currentDistance"></td>
                    <td id="currentHeight"></td>
                    <td>Current Position</td>
                    <td id="currentLat"></td>
                    <td id="currentLon"></td>
                    <td id="currentDistFromCurrent"></td>
                </tr>
                <tr>
                    <td id="highestPointDistance"></td>
                    <td id="highestPointHeight"></td>
                    <td>Highest Point</td>
                    <td id="highestPointLat"></td>
                    <td id="highestPointLon"></td>
                    <td id="highestPointDistFromCurrent"></td>
                </tr>
                <tr>
                    <td id="finishDistance"></td>
                    <td id="finishHeight"></td>
                    <td>Finish</td>
                    <td id="finishLat"></td>
                    <td id="finishLon"></td>
                    <td id="finishDistFromCurrent"></td>
                </tr>
                
                <tr>
                    <td>0.0</td>
                    <td>106</td>
                    <td>toilets</td>
                    <td>52.4816371</td>
                    <td>17.005672</td>
                    <td id="importantPointDistFromCurrent_0"></td>
                </tr>
                <tr>
                    <td>0.0</td>
                    <td>106</td>
                    <td>recycling</td>
                    <td>52.4812834</td>
                    <td>17.0053564</td>
                    <td id="importantPointDistFromCurrent_1"></td>
                </tr>
                <tr>
                    <td>0.0</td>
                    <td>106</td>
                    <td>shelter</td>
                    <td>52.48125607692308</td>
                    <td>17.00522301153846</td>
                    <td id="importantPointDistFromCurrent_2"></td>
                </tr>
                <tr>
                    <td>0.0</td>
                    <td>105</td>
                    <td>map</td>
                    <td>52.4812591</td>
                    <td>17.0056387</td>
                    <td id="importantPointDistFromCurrent_3"></td>
                </tr>
                <tr>
                    <td>0.5</td>
                    <td>144</td>
                    <td>peak Dziewicza Góra</td>
                    <td>52.479996</td>
                    <td>17.0111017</td>
                    <td id="importantPointDistFromCurrent_4"></td>
                </tr>
                <tr>
                    <td>0.5</td>
                    <td>144</td>
                    <td>shelter</td>
                    <td>52.4800919</td>
                    <td>17.0109379</td>
                    <td id="importantPointDistFromCurrent_5"></td>
                </tr>
                <tr>
                    <td>0.5</td>
                    <td>144</td>
                    <td>board Góra Anny</td>
                    <td>52.4801481</td>
                    <td>17.011057</td>
                    <td id="importantPointDistFromCurrent_6"></td>
                </tr>
                <tr>
                    <td>0.5</td>
                    <td>144</td>
                    <td>guidepost</td>
                    <td>52.4801496</td>
                    <td>17.0110113</td>
                    <td id="importantPointDistFromCurrent_7"></td>
                </tr>
                <tr>
                    <td>0.5</td>
                    <td>145</td>
                    <td>nature Szczyt Dziewiczej Góry</td>
                    <td>52.4801623</td>
                    <td>17.0111737</td>
                    <td id="importantPointDistFromCurrent_8"></td>
                </tr>
                <tr>
                    <td>0.5</td>
                    <td>145</td>
                    <td>tower Wieża widokowa na Dziewiczej Górze</td>
                    <td>52.48003285</td>
                    <td>17.01133309</td>
                    <td id="importantPointDistFromCurrent_9"></td>
                </tr>
                <tr>
                    <td>3.0</td>
                    <td>119</td>
                    <td>wayside_cross</td>
                    <td>52.480534</td>
                    <td>17.0150263</td>
                    <td id="importantPointDistFromCurrent_10"></td>
                </tr>
                <tr>
                    <td>4.0</td>
                    <td>106</td>
                    <td>map</td>
                    <td>52.4819636</td>
                    <td>17.0061648</td>
                    <td id="importantPointDistFromCurrent_11"></td>
                </tr>
                <tr>
                    <td>4.0</td>
                    <td>106</td>
                    <td>peak</td>
                    <td>52.4844672</td>
                    <td>17.0033025</td>
                    <td id="importantPointDistFromCurrent_12"></td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>

